---
import CartSidebar from "@/components/fragments/CartSidebar.astro";

const cartId = Astro.cookies.get("cartId")?.value;
const API_URL = import.meta.env.API_URL || "http://localhost:3000";

let items: any[] = [];
let subtotal = 0;
let itemCount = 0;

if (cartId) {
  try {
    const response = await fetch(`${API_URL}/api/v1/cart?cartId=${cartId}`);
    if (response.ok) {
      const cart = await response.json();
      items = cart.data?.items || [];
      subtotal = cart.data?.subtotal || 0;
      itemCount = cart.data?.itemCount || 0;
    }
  } catch (e) {
    console.error("Failed to fetch cart:", e);
  }
}
---
<CartSidebar items={items} subtotal={subtotal} itemCount={itemCount} />
